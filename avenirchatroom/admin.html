<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>聊天室審批後台</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f7f7f7; }
    h2 { margin-bottom: 10px; }
    #pending-chat { width: 500px; max-height: 600px; overflow-y: auto; border: 1px solid #ccc; padding: 10px; border-radius: 8px; background: rgba(0,0,0,0.05);}
    .chat-message { margin-bottom: 8px; padding: 8px 12px; border-radius: 10px; background: rgba(173,216,230,0.5); display: flex; justify-content: space-between; align-items: center; }
    button { cursor: pointer; margin-left: 10px; padding: 4px 8px; }
  </style>
</head>
<body>

<h2>審批未批准留言</h2>
<div id="pending-chat"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
import { getFirestore, collection, query, where, orderBy, onSnapshot, updateDoc, doc } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";

// 🔹 Firebase 配置
const firebaseConfig = {
  apiKey: "AIzaSyBJ1UGX6XNIhRSPedPbm9NBuM-rS6fdrwo",
  authDomain: "avenirstage-75a78.firebaseapp.com",
  projectId: "avenirstage-75a78",
  storageBucket: "avenirstage-75a78.appspot.com",
  messagingSenderId: "486755613692",
  appId: "1:486755613692:web:0d5c3b3bbbe8bd90021079"
};

// 初始化 Firebase
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const pendingDiv = document.getElementById("pending-chat");
const messagesRef = collection(db, "chatMessages");

// 監聽未批准留言，按時間升序
const pendingQuery = query(messagesRef, where("approved", "==", false), orderBy("timestamp", "asc"));

onSnapshot(pendingQuery, snapshot => {
  pendingDiv.innerHTML = "";
  snapshot.forEach(docSnap => {
    const msg = docSnap.data();
    const div = document.createElement("div");
    div.className = "chat-message";
    div.textContent = msg.text; // 不顯示使用者名稱

    const approveBtn = document.createElement("button");
    approveBtn.textContent = "批准";
    approveBtn.onclick = async () => {
      await updateDoc(doc(db, "chatMessages", docSnap.id), { approved: true });
    };

    div.appendChild(approveBtn);
    pendingDiv.appendChild(div);
  });
});
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>èŠå¤©å®¤ç®¡ç†å¾Œå°</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    button { padding: 5px 10px; }
  </style>
</head>
<body>

<h2>ç•™è¨€å¯©æ‰¹ç®¡ç†</h2>

<table>
  <thead>
    <tr>
      <th>ä½¿ç”¨è€…</th>
      <th>ç•™è¨€</th>
      <th>ç‹€æ…‹</th>
      <th>æ“ä½œ</th>
    </tr>
  </thead>
  <tbody id="messages-table">
    <!-- ç•™è¨€æœƒè¢«å‹•æ…‹å¡«å…¥ -->
  </tbody>
</table>

<!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
  import { getFirestore, collection, onSnapshot, doc, updateDoc } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";

  // ğŸ”¹ Firebase é…ç½®
  const firebaseConfig = {
    apiKey: "AIzaSyBJ1UGX6XNIhRSPedPbm9NBuM-rS6fdrwo",
    authDomain: "avenirstage-75a78.firebaseapp.com",
    projectId: "avenirstage-75a78",
    storageBucket: "avenirstage-75a78.appspot.com",
    messagingSenderId: "486755613692",
    appId: "1:486755613692:web:0d5c3b3bbbe8bd90021079"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const tableBody = document.getElementById("messages-table");

  // ğŸ”¹ ç›£è½æ‰€æœ‰ç•™è¨€ (åŒ…å«æœªæ‰¹å‡†)
  const messagesRef = collection(db, "chatMessages");
  onSnapshot(messagesRef, (snapshot) => {
    tableBody.innerHTML = "";
    snapshot.forEach((docItem) => {
      const msg = docItem.data();
      const tr = document.createElement("tr");

      tr.innerHTML = `
        <td>${msg.user}</td>
        <td>${msg.text}</td>
        <td>${msg.approved ? "å·²æ‰¹å‡†" : "æœªæ‰¹å‡†"}</td>
        <td>
          ${!msg.approved ? `<button data-id="${docItem.id}">æ‰¹å‡†</button>` : ""}
        </td>
      `;
      tableBody.appendChild(tr);
    });

    // ğŸ”¹ ç¶å®šæ‰¹å‡†æŒ‰éˆ•äº‹ä»¶
    tableBody.querySelectorAll("button").forEach(btn => {
      btn.addEventListener("click", async () => {
        const id = btn.getAttribute("data-id");
        const docRef = doc(db, "chatMessages", id);
        await updateDoc(docRef, { approved: true });
      });
    });
  });
</script>

</body>
</html>

